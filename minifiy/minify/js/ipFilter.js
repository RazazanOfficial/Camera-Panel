"use strict";document.addEventListener("DOMContentLoaded",(()=>{const t=document.querySelector('[data-tab-content="ipAddressFilter"]');if(!t)return;const e=t.querySelector("#ipFilterTbody"),n=t.querySelector("#btnIpAdd");function i(){e.innerHTML='\n      <tr>\n        <td class="border-2 text-center" colspan="4">No data</td>\n      </tr>\n    '}function a(t){if(!Array.isArray(t)||0===t.length)return void i();const n=t.map(((t,e)=>{const n=e+1,i=t.ip||"",a=t.status||"";return`\n          <tr data-line="${n}">\n            <th scope="row" class="border-2">${n}</th>\n            <td class="border-2">${i}</td>\n            <td class="border-2">${r=a,String(r||"").toLowerCase().replace(/^\w/,(t=>t.toUpperCase()))}</td>\n            <td class="border-2">\n              <button\n                type="button"\n                class="btn btn-link p-0 me-3"\n                data-action="modify"\n                title="Modify"\n                aria-label="Modify"\n              >\n                Modify\n              </button>\n              <button\n                type="button"\n                class="btn btn-link text-danger p-0"\n                data-action="delete"\n                title="Delete"\n                aria-label="Delete"\n              >\n                Delete\n              </button>\n            </td>\n          </tr>\n        `;var r})).join("");e.innerHTML=n}async function r(){try{const t=await apiGet(API_ENDPOINTS.firewallList);a(t?.ip_list||[])}catch(t){console.error("[ipFilter] GET list failed:",t),i(),window.toast?.error?.("Failed to load IP filter list")}}n&&n.addEventListener("click",(()=>{window.IpModal&&IpModal.openAdd((async({ip:t,status:e})=>{try{await async function({ip:t,status:e}){const n={ip_filter:t,status:e};return apiPost(API_ENDPOINTS.firewallAdd,n)}({ip:t,status:e}),window.toast?.success?.("Entry added"),await r()}catch(n){console.error("[ipFilter] add failed:",n),window.toast?.error?.("Add failed")}}))})),e.addEventListener("click",(t=>{const e=t.target.closest("button[data-action]");if(!e)return;const n=e.closest("tr"),i=Number(n?.dataset?.line),a=n?.children?.[1]?.textContent?.trim()||"",o=n?.children?.[2]?.textContent?.trim().toLowerCase()||"allowed";if("modify"===e.dataset.action){if(!window.IpModal)return;IpModal.openEdit({ip:a,status:o,line_number:i},(async({line_number:t,ip:e,status:n})=>{try{await async function({line_number:t,ip:e,status:n}){const i={line_number:t,ip:e,status:n};return apiPost(API_ENDPOINTS.firewallModify,i)}({line_number:t,ip:e,status:n}),window.toast?.success?.("Entry updated"),await r()}catch(i){console.error("[ipFilter] modify failed:",i),window.toast?.error?.("Update failed")}}))}if("delete"===e.dataset.action){if(!window.IpModal)return;IpModal.openDelete({line_number:i,ip:a},(async({line_number:t})=>{try{await async function({line_number:t}){const e={line_number:t};return apiPost(API_ENDPOINTS.firewallDelete,e)}({line_number:t}),window.toast?.success?.("Entry deleted"),await r()}catch(e){console.error("[ipFilter] delete failed:",e),window.toast?.error?.("Delete failed")}}))}})),r()}));