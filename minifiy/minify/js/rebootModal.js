(()=>{const e={modal:document.getElementById("rebootModal"),title:document.getElementById("rebootTitle"),confirmText:document.getElementById("rebootConfirmText"),actions:document.getElementById("rebootActions"),warning:document.getElementById("rebootWarning"),countdown:document.getElementById("rebootCountdown"),btnCancel:document.getElementById("rebootCancel"),btnConfirm:document.getElementById("rebootConfirm")};if(!e.modal)return;let n=new bootstrap.Modal(e.modal,{backdrop:!0,keyboard:!0}),t={enabled:!1,removeKeydown:null,removeBeforeUnload:null},o=null,r=!1;function a(r,a,d){e.title.textContent=a||"Rebootingâ€¦",e.confirmText.innerHTML=d||"Camera is Rebooting, Please wait!",e.actions.style.display="none",e.warning.style.display="",e.modal.setAttribute("data-bs-backdrop","static"),e.modal.setAttribute("data-bs-keyboard","false");try{n.show()}catch{}!function(n,t){o&&clearInterval(o);let r=n;e.countdown.textContent=String(r),o=setInterval((()=>{r-=1,e.countdown.textContent=String(r),r<=0&&(clearInterval(o),o=null,"function"==typeof t&&t())}),1e3)}(r??15,(()=>{t.enabled=!1,t.removeKeydown&&t.removeKeydown(),t.removeBeforeUnload&&t.removeBeforeUnload(),setTimeout((()=>window.location.reload()),50)}))}e.modal.addEventListener("hide.bs.modal",(e=>{r&&e.preventDefault()})),window.RebootModal={confirmAndReboot:async function(o={}){return r?(a(o.seconds,o.lockTitle,o.lockMessage),Promise.resolve()):(d=o,e.title.textContent=d.title||"Confirm Action",e.confirmText.innerHTML=d.message||"This change will <b>reboot the camera</b>. Are you sure?",e.actions.style.display="",e.warning.style.display="none",e.countdown.textContent=String(d.seconds||15),e.btnConfirm.disabled=!1,e.btnCancel.disabled=!1,n.show(),new Promise(((n,d)=>{const l=()=>{c(),"function"==typeof o.onCancel&&o.onCancel(),d(new Error("cancelled"))},i=async()=>{e.btnConfirm.disabled=!0,e.btnCancel.disabled=!0;try{"function"==typeof o.onConfirm&&await o.onConfirm(),r=!0,function(){if(t.enabled)return;t.enabled=!0;const e=e=>(e.preventDefault(),e.returnValue="","");window.addEventListener("beforeunload",e),t.removeBeforeUnload=()=>window.removeEventListener("beforeunload",e);const n=e=>{const n="F5"===e.key||116===e.keyCode,t=(e.ctrlKey||e.metaKey)&&"r"===e.key?.toLowerCase?.();(n||t)&&(e.preventDefault(),e.stopPropagation())};document.addEventListener("keydown",n,!0),t.removeKeydown=()=>document.removeEventListener("keydown",n,!0)}(),a(o.seconds,o.lockTitle,o.lockMessage),c(),n()}catch(l){window.toast?.error&&toast.error("Operation failed."),e.btnConfirm.disabled=!1,e.btnCancel.disabled=!1,d(l)}},c=()=>{e.btnCancel.removeEventListener("click",l),e.modal.removeEventListener("hide.bs.modal",s),e.btnConfirm.removeEventListener("click",i)},s=()=>{r||l()};e.btnCancel.addEventListener("click",l),e.modal.addEventListener("hide.bs.modal",s),e.btnConfirm.addEventListener("click",i)})));var d}}})();