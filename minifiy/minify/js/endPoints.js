"use strict";document.addEventListener("DOMContentLoaded",()=>{const videoTbody=document.getElementById("videoEndpoints");const imageTbody=document.getElementById("imageEndpoints");if(!videoTbody||!imageTbody)return;function getHostFromDeviceIp(){try{const raw=(typeof DEVICE_IP==="string"&&DEVICE_IP)?DEVICE_IP:window.location.host;return raw.replace(/:80$/i,"")}catch{return window.location.host}}
const HOST=getHostFromDeviceIp();const endpoints={videos:[{label:"RTSP main stream",value:`rtsp://${HOST}/stream=0`},{label:"RTSP sub stream",value:`rtsp://${HOST}/stream=1`},{label:"RTSP JPEG stream",value:`rtsp://${HOST}/stream=2`},{label:"MJPEG video stream",value:`http://${HOST}/mjpeg`},{label:"MP4 video stream",value:`http://${HOST}/video.mp4`},{label:"HLS (web browser live)",value:`http://${HOST}/hls`},],images:[{label:"Snapshot (JPEG)",value:`http://${HOST}/image.jpg`},],};function makeRow({label,value}){const tr=document.createElement("tr");tr.setAttribute("data-copy",value);const tdLabel=document.createElement("td");tdLabel.className="fw-semibold";tdLabel.textContent=label;const tdValue=document.createElement("td");const code=document.createElement("code");code.textContent=value;tdValue.appendChild(code);const tdCopy=document.createElement("td");tdCopy.className="text-end";const btn=document.createElement("button");btn.type="button";btn.className="btn btn-sm btn-outline-light";btn.textContent="Copy";btn.setAttribute("data-copy",value);tdCopy.appendChild(btn);tr.appendChild(tdLabel);tr.appendChild(tdValue);tr.appendChild(tdCopy);return tr}
function renderList(tbody,list){tbody.innerHTML="";list.forEach(item=>tbody.appendChild(makeRow(item)))}
async function copyToClipboard(text){try{await navigator.clipboard.writeText(text);window.toast?.success?.("Copied to clipboard")}catch(e){try{const ta=document.createElement("textarea");ta.value=text;ta.style.position="fixed";ta.style.left="-9999px";document.body.appendChild(ta);ta.select();document.execCommand("copy");document.body.removeChild(ta);window.toast?.success?.("Copied to clipboard")}catch(err){console.error("[endpoints] copy failed:",err);window.toast?.error?.("Copy failed")}}}
function delegateCopy(container){container.addEventListener("click",(ev)=>{const node=ev.target.closest("[data-copy]");if(!node)return;const text=node.getAttribute("data-copy")||node.textContent||"";if(!text.trim())return;ev.preventDefault();copyToClipboard(text.trim())})}
renderList(videoTbody,endpoints.videos);renderList(imageTbody,endpoints.images);delegateCopy(videoTbody);delegateCopy(imageTbody)})